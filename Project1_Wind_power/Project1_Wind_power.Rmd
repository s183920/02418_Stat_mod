---
title: "Project1: Wind power energy"
output: 
  html_document:
  toc: true
  toc_float: true
  # toc_collapsed: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Packages

```{r include=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(GGally)
library(magrittr)
library(MASS)
```


# Data

## Load
```{r}
wind_data <- read.table("../Data/tuno.txt", header = T, sep = " ")
summary(wind_data)
```

## Plot

```{r}
# ggpairs(~pow.obs + ws30 + wd30, wind_data)
pairplot  <- ggpairs(wind_data, columns = c("pow.obs", "ws30", "wd30"))
pairplot
ggsave("Plots/pairplot_wind.png", pairplot)
```

### QQ-plots

```{r}
qqnorm(wind_data[pow.obs], ylim, main = "Normal Q-Q Plot",
       xlab = "Theoretical Quantiles", ylab = "Sample Quantiles",
       plot.it = TRUE, datax = FALSE)
qqline(wind_data[1])

plot(wind_data$r.day)
wind_data$r.day %>% as.factor() %>%  density() %>% plot()
```




# Data transformations

## Box-Cox
```{r}



## profile likelihood for lambda
lp.lambda <- function(lambda,y,func="boxcox"){
  n <- length(y)
  
  if (func == "proposed1"){
    #print("proposed 1")
    y.l <- 1/lambda*log((y^lambda)/(1-y^lambda))
  }
  
  if (func == "proposed2"){
    #print("proposed 2")
    y.l <- 2*log(y^lambda/(1-y)^(1-lambda))
  }
  
  else{
    #print("boxcox 1")
    y.l <- (y^lambda-1)/lambda
    if(lambda==0){y.l <- log(y)}
  }

  sigmasq <- 1/n * sum((y.l-mean(y.l))^2)
  -n/2 * log(sigmasq) + (lambda-1)*sum(log(y))
}

bc.trans <- function(lambda,y){
  y.l <- (y^lambda-1)/lambda
  if(lambda==0){y.l <- log(y)}
  return(y.l)
}

datasets = cbind(wind_data$wd30, wind_data$pow.obs, wind_data$ws30)
range = cbind(c(-3,3), c(0,1000), c(0,1))
funcs = c("boxcox", "proposed1", "proposed2")

lp.lambda(0.8,datasets[,2], "boxcox")


par(mfrow=c(3,3))
opt = optimize(lp.lambda, range[,1],y=datasets[,1], maximum=TRUE)$maximum
qqnorm(bc.trans(opt, datasets[,1]))
qqline(bc.trans(opt, datasets[,1]))

fit <- fitdistr(datasets[,1], "normal")
aic = AIC(fit, k = 2)
para <- fit$estimate
hist(datasets[,1], prob = TRUE, title = as.character(aic))
x <- seq(5, 15, length=1000)
curve(dnorm(x, para[1], para[2]), col = 2, add = TRUE)

fit <- fitdistr(bc.trans(opt, datasets[,1]), "normal")
aic = AIC(fit, k = 2)
para <- fit$estimate
hist(bc.trans(opt, datasets[,1]), prob = TRUE, title = as.character(aic))
x <- seq(5, 15, length=1000)
curve(dnorm(x, para[1], para[2]), col = 2, add = TRUE)




opt = optimize(lp.lambda,range[,1],y=datasets[,2], func=funcs[1], maximum=TRUE)$maximum
qqnorm(bc.trans(opt, datasets[,2]))
qqline(bc.trans(opt, datasets[,2]))

fit <- fitdistr(datasets[,3], "normal")
aic = AIC(fit, k = 2)
para <- fit$estimate
hist(datasets[,3], prob = TRUE, title = as.character(aic))
x <- seq(5, 15, length=1000)
curve(dnorm(x, para[1], para[2]), col = 2, add = TRUE)

fit <- fitdistr(bc.trans(opt, datasets[,2]), "normal")
aic = AIC(fit, k = 2)
para <- fit$estimate
hist(bc.trans(opt, datasets[,2]), prob = TRUE, title = as.character(aic))
x <- seq(5, 15, length=1000)
curve(dnorm(x, para[1], para[2]), col = 2, add = TRUE)



opt = optimize(lp.lambda,range[,1],y=datasets[,3], func=funcs[1], maximum=TRUE)$maximum
qqnorm(bc.trans(opt, datasets[,3]))
qqline(bc.trans(opt, datasets[,3]))

fit <- fitdistr(datasets[,3], "normal")
aic = AIC(fit, k = 2)
para <- fit$estimate
hist(datasets[,3], prob = TRUE, title = as.character(aic))
x <- seq(5, 15, length=1000)
curve(dnorm(x, para[1], para[2]), col = 2, add = TRUE)

fit <- fitdistr(bc.trans(opt, datasets[,3]), "normal")
aic = AIC(fit, k = 2)
para <- fit$estimate
hist(bc.trans(opt, datasets[,3]), prob = TRUE, title = as.character(aic))
x <- seq(5, 15, length=1000)
curve(dnorm(x, para[1], para[2]), col = 2, add = TRUE)





# par(mfrow=c(3,3))
# for (i in c(1,3)){
#   for (j in c(1,2,3)){
#     opt = optimize(lp.lambda,range[,i],y=datasets[,j], func=funcs[i], maximum=TRUE)$maximum
#     qqnorm(bc.trans(opt, datasets[,j]))
#     qqline(bc.trans(opt, datasets[,j]))
# 
#   }
# }


```




## Log-transformation
```{r}
#Log
```



# Models


## Normal distribution
```{r}


all_models = c("beta", "cauchy", "chi-squared", "exponential", "gamma", "geometric", "log-normal", "lognormal", "logistic", "negative binomial", "normal", "Poisson", "t", "weibull")


models = c( "beta", "gamma", "lognormal", "normal")


fit <- fitdistrplus(datasets[,3], beta, )

for (model in models){
  fit <- fitdistr(datasets[,3], model)
  aic = AIC(fit, k = 2)
  print(model)
  print(aic)
  # para <- fit$estimate
  # hist(datasets[,3], prob = TRUE, title = as.character(aic))
  # x <- seq(5, 15, length=1000)
  # curve(dnorm(x, para[1], para[2]), col = 2, add = TRUE)
}
library(CRAN)
## Multimodal distribution
```

```


## Von Mises distribution
```{r}
?fitdistr()

```


## Gamma distribution 
```{r}

```












